# $This file is distributed under the terms of the license in LICENSE$

@prefix auth: <http://vitro.mannlib.cornell.edu/ns/vitro/authorization#> .
@prefix access-individual: <https://vivoweb.org/ontology/vitro-application/auth/individual/> .
@prefix access: <https://vivoweb.org/ontology/vitro-application/auth/vocabulary/> .
@prefix : <https://vivoweb.org/ontology/vitro-application/auth/individual/edit-individual-pages/> .

:Policy a access:Policy ;
    access:hasRule :AllowEditRelatedPagesRule ;
    access:hasRule :AllowEditIndividualPagesRule .

:AllowEditIndividualPagesRule a access:Rule;
    access:requiresCheck :SubjectRoleOneOfEditorsCheck ;
    access:requiresCheck :IsAddOperation ;
    access:requiresCheck :IsObjectPropertyStatement ;
    access:requiresCheck :ObjectUriIsSomeUri ;
    access:requiresCheck :PredicateIsSomePredicate .

:SubjectRoleOneOfEditorsCheck a access:Check ;
    access:useOperator access-individual:OneOf ;
    access:attribute access-individual:SubjectRole ;
    access:value access-individual:AdminRoleUri ;
    access:value access-individual:CuratorRoleUri ;
    access:value access-individual:EditorRoleUri .

:SubjectRoleIsSelfEditor a access:Check ;
    access:useOperator access-individual:Equals ;
    access:attribute access-individual:SubjectRole ;
    access:value access-individual:SelfEditorRoleUri .

:IsAddOperation a access:Check ;
    access:useOperator access-individual:Equals ;
    access:attribute access-individual:Operation ;
    access:value access-individual:AddOperation .

:AllowEditRelatedPagesRule a access:Rule;
    access:requiresCheck :SubjectRoleIsSelfEditor ;
    access:requiresCheck :SubjectUriIsProfileRelatedResource ;
    access:requiresCheck :IsAddOperation ;
    access:requiresCheck :IsObjectPropertyStatement ;
    access:requiresCheck :ObjectUriIsSomeUri ;
    access:requiresCheck :PredicateIsSomePredicate .

:PredicateIsSomePredicate a access:Check ;
    access:useOperator access-individual:Equals ;
    access:attribute access-individual:StatementPredicateUri ;
    access:value :SomeUri .

:ObjectUriIsSomeUri a access:Check ;
    access:useOperator access-individual:Equals ;
    access:attribute access-individual:StatementObjectUri ;
    access:value :SomeUri .

:SubjectUriIsProfileRelatedResource a access:Check ;
    access:useOperator access-individual:SparqlSelectQueryContains ;
    access:attribute access-individual:StatementSubjectUri ;
    access:value access-individual:PersonProfileProximityToResourceUri .

:IsObjectPropertyStatement a access:Check ;
    access:useOperator access-individual:Equals ;
    access:attribute access-individual:AccessObjectType ;
    access:value access-individual:ObjectPropertyStatement .

:SomeUri a access:AttributeUriValue ;
    access:id "?SOME_URI" .

